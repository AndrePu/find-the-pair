!function(e){var t={};function n(o){if(t[o])return t[o].exports;var l=t[o]={i:o,l:!1,exports:{}};return e[o].call(l.exports,l,l.exports,n),l.l=!0,l.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var l in e)n.d(o,l,function(t){return e[t]}.bind(null,l));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";n.r(t);const o={VISIBLE:"visible",HIDDEN:"hidden"},l={BLOCK:"block",NONE:"none",FLEX:"flex"},a={HIDDEN:"hidden",AUTO:"auto"},s="Enter",c="Escape",m="3x4",i="4x4",r="5x4",d="6x6",u="Укажите, пожалуйста, свое имя",g="Выберите язык интерфейса для дальнейшей работы",y="Следует указать размерность поля, чтобы начать игру",E="Выберите цветовое оформление, чтобы продолжить",f={dark:{color:"white",background:"rgb(43, 43, 43)",cardDefaultBackground:"rgb(116, 116, 116)",buttonClassName:"dark-mode-button",modalWindowContentClassName:"dark-mode-modal-content",iconClassName:"dark-mode-icon",tablinkActiveClassName:"active-dark-mode"},light:{color:"black",background:"mintcream",cardDefaultBackground:"paleturquoise",buttonClassName:"light-mode-button",modalWindowContentClassName:"light-mode-modal-content",iconClassName:"light-mode-icon",tablinkActiveClassName:"active-light-mode"}};const b=e=>`url('${e}')`,h=e=>{let t=[];return e.forEach(e=>{t.push({randNum:Math.random(),element:e})}),t.sort((e,t)=>e.randNum-t.randNum),t.map(e=>e.element)};const _={BACKGROUND_SIZE:"cover",BACKGROUND_POSITION:"center center",cardDefaultBackground:"#378cee"},I={states:{GAME_SETUP:"game_setup",GAME_PROCESS:"game_process",GAME_RESULT:"game_result",GAME_RECORD:"game_record"},currentState:"game_setup",followingState:{game_setup:"game_process",game_process:"game_result",game_result:"game_record",game_record:"game_result"},goToTheFollowingState(){document.getElementById(I.followingState[I.currentState]).style.display=l.BLOCK,document.getElementById(I.currentState).style.display=l.NONE,I.currentState=I.followingState[I.currentState]}},B={username:null,interfaceLanguage:null,fieldSize:null,theme:null},N={tablinksActiveClassName:{dark:"active-dark-mode",light:"active-light-mode"},defaultTablinkClassName:"tablinks",onRecordTabLinkClick(e){const t=document.getElementsByClassName("tablinks");for(let n=0;n<t.length;n++)t[n].innerText===e?t[n].className+=SPACE+this.tablinksActiveClassName[B.theme]:t[n].className=this.defaultTablinkClassName},initializeRecordTableButtons(){const e=document.getElementsByClassName("tablinks");for(let t=0;t<e.length;t++){if(e[t].innerText===B.fieldSize){e[t].className+=SPACE+this.tablinksActiveClassName[B.theme];break}e[t].className=this.defaultTablinkClassName}},defaultRecordTableButtons(){const e=document.getElementsByClassName("tablinks");for(let t=0;t<e.length;t++)e[t].className=this.defaultTablinkClassName}};let p,S,k,C=[],T=null,v=null,O=0,L={},w=null,A=!1,x=0,D=!1;const R=new class{constructor(){this._time=0,this._timeoutId=null}set timeoutId(e){this._timeoutId=e}get timeoutId(){return this._timeoutId}set time(e){this._time=e,this._timeListener&&this._timeListener(e)}get time(){return this._time}registerTimeListener(e){this._timeListener=e}run(){this.timeoutId=setTimeout(()=>{this.time++,this.run()},1e3)}pause(){clearTimeout(this._timeoutId)}reset(){clearTimeout(this._timeoutId),this.timeoutId=null,this.time=0}isLaunched(){return!!this.timeoutId}};function M(){if(I.currentState===I.states.GAME_PROCESS)return;const e=document.getElementById("name"),t=document.getElementsByName("language"),n=document.getElementsByName("field-size"),l=document.getElementsByName("theme"),a=document.getElementById("error_label"),s=W(t),c=W(n),f=W(l);return e.value?(B.username=e.value,-1===s?(a.innerText=g,void(a.style.visibility=o.VISIBLE)):(B.interfaceLanguage=t[s].value,-1===c?(a.innerText=y,void(a.style.visibility=o.VISIBLE)):(B.fieldSize=n[c].value,-1===f?(a.innerText=E,void(a.style.visibility=o.VISIBLE)):(B.theme=l[f].value,I.goToTheFollowingState(),function(){switch(B.fieldSize){case m:v=3,T=4;break;case i:v=4,T=4;break;case r:v=5,T=4;break;case d:v=6,T=6}O=v*T/2}(),p=function(){let e=[];for(let t=1;t<=O;t++)e.push(`images/${t}.jpg`);return e}(),S=h(function(e,t){let n=[];for(let o=1;o<=e;o++)for(let e=1;e<=t;e++)n.push(`card${o}${e}`);return n}(v,T)),function(){const e=document.getElementById(I.states.GAME_PROCESS);for(let t=1;t<=v;t++){let n=document.createElement("div");e.prepend(n);for(let e=1;e<=T;e++){let o=document.createElement("div");o.className="card",o.id=`card${t}${e}`,n.append(o)}}}(),z(),K(),H(),void j())))):(a.innerText=u,void(a.style.visibility=o.VISIBLE))}function P(){if(!R.isLaunched())return;document.body.style.overflow=a.HIDDEN;const e=document.getElementById("modal_window");e.style.pointerEvents="auto",e.style.opacity=1,R.pause(),A=!0}function G(){document.body.style.overflow=a.AUTO;const e=document.getElementById("modal_window");e.style.pointerEvents="none",e.style.opacity=0,R.run(),A=!1}function $(){G(),R.pause(),function(){w=null,k=!0,R.reset(),x=0;document.getElementById("attempts").innerHTML=x,function(){for(let e=0;e<S.length;e++)if(!L[S[e]].visible){document.getElementById(S[e]).style.visibility=o.VISIBLE}}()}(),S=h(S),K(),H(),j()}function U(){R.pause();const e=function(e,t,n){const o=n*n/324*1e5-5*t-10*(e-2*n);return Math.round(1e4+(o>0?o:0))}(x,R.time,O);let t=JSON.parse(localStorage.getItem(B.fieldSize));const n={name:B.username,attempts:x,time:R.time,score:e};let o=!1,l=e,a=l;t?Number(t.maxScore.score)<e?(o=!0,a=t.maxScore.score,t.scores=[t.maxScore].concat(t.scores),t.maxScore=n):(t.scores.push(n),t.scores.sort((e,t)=>t.score-e.score)):(t={maxScore:{},scores:[]},t.maxScore=n,a=0,o=!0),10===t.scores.length&&t.scores.pop(),l=t.maxScore.score,localStorage.setItem(B.fieldSize,JSON.stringify(t));const s=function(e,t,n,o){return`Поздравляем. Вы победили!\nВаш счет: ${t} очков\n`+(e?"О, дааа. Да вы еще побили старый рекорд!\n":"")+`Максимальный счет: ${n} очков\n`+(e?"Старый максимальный счет: "+o:"")}(o,e,l,a);document.getElementById("game_result_label").innerText=s,I.goToTheFollowingState()}function z(){document.body.style.color=f[B.theme].color,document.body.style.background=f[B.theme].background,_.cardDefaultBackground=f[B.theme].cardDefaultBackground,document.getElementById("pause_button").className=f[B.theme].buttonClassName,document.getElementById("modal_window_content").className=f[B.theme].modalWindowContentClassName,document.getElementById("modal_icon").className=f[B.theme].iconClassName,document.getElementById("modal_resume_button").className=f[B.theme].buttonClassName,document.getElementById("modal_restart_button").className=f[B.theme].buttonClassName,document.getElementById("modal_options_button").className=f[B.theme].buttonClassName,document.getElementById("modal_menu_button").className=f[B.theme].buttonClassName,document.getElementById("modal_optionsApply_button").className=f[B.theme].buttonClassName,document.getElementById("restart_button").className=f[B.theme].buttonClassName,document.getElementById("records_button").className=f[B.theme].buttonClassName,document.getElementById("menu_button").className=f[B.theme].buttonClassName,document.getElementById("record_return_icon").className=f[B.theme].iconClassName;for(let e=0;e<S.length;e++)document.getElementById(S[e]).style.background=_.cardDefaultBackground}function K(){for(let e=0;e<S.length;e++)L[S[e]]={visible:!0,chosen:!1,chosenColor:b(p[e%(S.length/2)]),pair:S[(e+S.length/2)%S.length]}}function H(){for(let e=0;e<S.length;e++){let t=document.getElementById(S[e]);t.onclick=function(){if(k||S[e]==w)return;x++,document.getElementById("attempts").innerHTML=x;let n=L[S[e]].pair,l=document.getElementById(n);if(L[n].chosen){t.style.visibility=o.HIDDEN,l.style.visibility=o.HIDDEN,L[S[e]].visible=!1,L[n].visible=!1,w=null;let a=!0;for(let e=0;e<S.length;e++)if(L[S[e]].visible){a=!1;break}a&&U()}else t.style.backgroundImage=L[S[e]].chosenColor,t.style.backgroundSize=_.BACKGROUND_SIZE,t.style.backgroundPosition=_.BACKGROUND_POSITION,w?(k=!0,setTimeout(()=>{L[w].chosen=!1,document.getElementById(w).style.background=_.cardDefaultBackground,w=null,t.style.background=_.cardDefaultBackground,k=!1},1e3)):(L[S[e]].chosen=!0,w=S[e])}}}function j(){!function(){for(let e=0;e<S.length;e++){let t=document.getElementById(S[e]);t.style.backgroundImage=L[S[e]].chosenColor,t.style.backgroundSize=_.BACKGROUND_SIZE,t.style.backgroundPosition=_.BACKGROUND_POSITION}}(),setTimeout(()=>{!function(){for(let e=0;e<S.length;e++){document.getElementById(S[e]).style.background=_.cardDefaultBackground}}(),R.run(),k=!1},5e3)}function F(){const e=document.getElementById("modal_icon");e.title="Закрыть",e.innerText="×";document.getElementById("modal_title").innerText="Опции",D=!1;document.getElementById("modal_options_page").style.display=l.NONE;document.getElementById("modal_buttons_container").style.display=l.BLOCK}function V(){const e=document.getElementsByName("modal_theme"),t=W(e);B.theme=e[t].value,z()}function J(){D=!0;document.getElementById("modal_buttons_container").style.display=l.NONE;document.getElementById("modal_options_page").style.display=l.BLOCK;const e=document.getElementById("modal_icon");e.title="Назад",e.innerText="↩";document.getElementById("modal_title").innerText="Опции";document.getElementsByName("modal_theme").forEach(e=>{e.value===B.theme&&(e.checked=!0)});document.getElementsByName("modal_language").forEach(e=>{e.value===B.interfaceLanguage&&(e.checked=!0)})}function W(e){let t=-1;for(let n=0;n<e.length;n++)if(e[n].checked){t=n;break}return t}function Z(e){N.onRecordTabLinkClick(e);const t=JSON.parse(localStorage.getItem(e));q(),X(t)}function q(){for(let e=0;e<C.length;e++)document.getElementById(C[e]).remove();C=[]}function X(e){if(!e)return;const t=document.getElementById("records-table");Q(e.maxScore,1,t);for(let n=0;n<e.scores.length;n++)Q(e.scores[n],n+2,t)}function Q(e,t,n){let o=document.createElement("tr");o.id=`${e.name}${t}`,o.innerHTML=`<td>${t}</td><td>${e.name}</td><td>${e.attempts}</td><td>${e.time} сек</td><td>${e.score}</td>`,n.append(o),C.push(o.id)}R.registerTimeListener(e=>{document.getElementById("stopwatch").innerHTML=e+" сек"}),function(){document.getElementById("start_button").onclick=M;document.getElementById("pause_button").onclick=P;document.getElementById("modal_restart_button").onclick=$;document.getElementById("modal_resume_button").onclick=G;document.getElementById("modal_icon").onclick=()=>D?F():G();document.getElementById("modal_menu_button").onclick=()=>location.reload();document.getElementById("modal_options_button").onclick=J;document.getElementById("modal_optionsApply_button").onclick=V;document.getElementById("restart_button").onclick=()=>{I.currentState=I.states.GAME_PROCESS,document.getElementById(I.states.GAME_RESULT).style.display=l.NONE,document.getElementById(I.states.GAME_PROCESS).style.display=l.BLOCK,$()};document.getElementById("records_button").onclick=()=>{I.goToTheFollowingState(),N.initializeRecordTableButtons(),X(JSON.parse(localStorage.getItem(B.fieldSize)))};const e=document.getElementsByClassName("tablinks");for(let t=0;t<e.length;t++)e[t].onclick=()=>Z(e[t].innerHTML);document.getElementById("record_return_icon").onclick=()=>{q(),N.defaultRecordTableButtons(),I.goToTheFollowingState()};document.getElementById("menu_button").onclick=()=>location.reload()}(),window.onkeydown=e=>{switch(e.key){case s:switch(I.currentState){case I.states.GAME_SETUP:M();break;case I.states.GAME_RESULT:location.reload()}break;case c:switch(I.currentState){case I.states.GAME_PROCESS:A?D?F():G():P();break;case I.states.GAME_RECORD:q(),I.goToTheFollowingState()}}}}]);